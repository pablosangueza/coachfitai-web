@page "/checkout"
@using CoachFitAI.Web.Services
@inject AppState State
@inject IPaymentService Payments
@inject NavigationManager Nav

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5 text-center">

      <h2 class="cf-h2 mb-4">Checkout</h2>

      @if (State.Intake is null)
      {
        <p>No intake found. <a href="generate">Go back</a></p>
      }
      else
      {
        <p class="fs-5">Plan price: <b>$7</b></p>
        <button class="btn btn-primary px-4 mt-3" @onclick="Pay">Pay (mock)</button>
      }

    </div>
  </div>
</div>

@code {
  async Task Pay()
  {
    var order = await Payments.StartCheckoutAsync(7m);
    State.SetOrder(order);
    var ok = await Payments.ConfirmPaymentAsync(order.Id);
    if (ok) Nav.NavigateTo("thank-you");
  }
}
