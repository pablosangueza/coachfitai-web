@using CoachFitAI.Web.State
@inject AppState State
@inject NavigationManager Nav

<EditForm Model="@m" OnValidSubmit="OnSubmit">
  <div class="grid">
    <InputText @bind-Value="m.Gender" />
    <InputNumber @bind-Value="m.Age" />
    <InputNumber @bind-Value="m.WeightKg" />
    <InputNumber @bind-Value="m.HeightCm" />
    <InputText @bind-Value="m.Goal" />
    <InputText @bind-Value="m.Level" />
    <InputText @bind-Value="m.BodyType" />
    <InputText @bind-Value="restrictionsCsv" placeholder="restrictions (csv)" />
  </div>
  <button type="submit" class="btn">Continue to payment</button>
</EditForm>

@code {
  class IntakeModel {
    public string Gender { get; set; } = "M";
    public int Age { get; set; } = 30;
    public double WeightKg { get; set; } = 80;
    public double HeightCm { get; set; } = 175;
    public string Goal { get; set; } = "lose_fat";
    public string Level { get; set; } = "beginner";
    public string BodyType { get; set; } = "mesomorph";
    public string DailyActivity { get; set; } = "moderate";
    public string? PhotoUrl { get; set; }
  }

  IntakeModel m = new();
  string restrictionsCsv = "";

  void OnSubmit()
  {
    var dto = new IntakeDto(
      m.Gender, m.Age, m.WeightKg, m.HeightCm, m.Goal, m.Level, m.BodyType,
      restrictionsCsv.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries),
      m.DailyActivity, m.PhotoUrl);
    State.SetIntake(dto);
    Nav.NavigateTo("/checkout");
  }
}
